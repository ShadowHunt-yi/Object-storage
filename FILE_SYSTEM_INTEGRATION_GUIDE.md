# 🗃️ 本地文件系统集成功能指南

## 📋 功能概述

智域云图对象存储平台现已完成**本地文件系统深度集成**，为桌面用户提供更原生、更高效的文件管理体验。

---

## ✨ 新增功能特性

### 🎯 **1. 原生文件选择对话框**

#### 📁 **选择文件**
- **功能**: 使用系统原生对话框选择文件
- **特点**: 
  - 支持多文件选择
  - 智能文件类型过滤
  - 记忆上次访问位置

#### 📂 **选择文件夹**
- **功能**: 选择整个文件夹进行批量上传
- **特点**:
  - 递归读取所有子文件夹
  - 自动跳过隐藏文件
  - 最大深度控制（默认10层）

#### 🗂️ **混合选择**
- **功能**: 支持同时选择文件和文件夹
- **特点**:
  - 灵活的选择模式
  - 智能去重机制
  - 统一队列管理

### 🚀 **2. 增强拖拽上传**

#### 📋 **支持内容**
- ✅ 单个文件拖拽
- ✅ 多个文件拖拽
- ✅ 整个文件夹拖拽（包含子文件夹）
- ✅ 混合文件夹和文件拖拽

#### 🎨 **用户体验**
- 实时拖拽状态提示
- 文件夹内容自动解析
- 进度可视化显示

### 📊 **3. 智能上传队列**

#### 🔧 **队列管理**
- **功能**: 统一管理所有待上传文件
- **特点**:
  - 实时状态跟踪
  - 批量操作支持
  - 错误自动重试

#### 📈 **状态监控**
- `pending` - 待上传
- `uploading` - 上传中
- `completed` - 已完成
- `error` - 上传失败

#### ⚡ **批量上传**
- 并发控制（默认3个文件同时上传）
- 智能队列调度
- 失败任务自动重试

### 🔧 **4. 原生系统集成**

#### 📂 **文件管理器集成**
- **在文件管理器中显示**: 快速定位文件位置
- **用默认应用打开**: 系统级文件关联
- **文件属性获取**: 大小、修改时间等详细信息

#### 🔍 **路径工具**
- 跨平台路径处理
- 文件名和扩展名解析
- 目录路径计算

---

## 🎮 使用指南

### 🚀 **快速开始**

1. **启动桌面应用**
   ```bash
   pnpm run electron:dev
   ```

2. **访问上传页面**
   - 导航到"文件管理" → "文件上传"
   - 在桌面模式下，会看到新增的"桌面文件系统集成"功能区

### 🎯 **选择文件操作**

#### **选择单个或多个文件**
1. 点击 `选择文件` 按钮
2. 在原生对话框中选择文件
3. 文件自动加入上传队列
4. 查看队列状态和进度

#### **选择文件夹**
1. 点击 `选择文件夹` 按钮
2. 选择目标文件夹
3. 系统自动递归读取所有文件
4. 显示文件夹统计信息

#### **混合选择**
1. 点击 `混合选择` 按钮
2. 选择操作类型：
   - "确定" = 选择文件夹
   - "取消" = 选择文件
3. 支持多个文件夹同时选择

### 🎯 **拖拽上传操作**

#### **文件拖拽**
1. 从文件管理器选择文件
2. 拖拽到上传区域
3. 释放鼠标完成添加

#### **文件夹拖拽**
1. 从文件管理器选择整个文件夹
2. 拖拽到上传区域
3. 系统自动解析文件夹内容
4. 所有文件加入上传队列

### 🎯 **队列管理操作**

#### **查看队列**
1. 点击 `上传队列 (数量)` 按钮
2. 打开队列管理对话框
3. 查看详细统计和文件列表

#### **批量上传**
1. 在队列对话框中点击 `开始批量上传`
2. 系统并发处理多个文件
3. 实时查看上传进度

#### **队列操作**
- **重试失败项**: 重新上传失败的文件
- **清空队列**: 移除所有排队文件
- **单文件操作**: 移除、查看文件位置

---

## 🔧 技术实现

### 🏗️ **架构设计**

```
┌─────────────────────────────────────┐
│           Vue 渲染进程               │
├─────────────────────────────────────┤
│  📱 Upload.vue (文件上传组件)        │
│  ├── 🎛️  文件选择按钮                │
│  ├── 📂  拖拽上传区域                │
│  ├── 📊  上传队列管理                │
│  └── 💾  批量上传控制                │
├─────────────────────────────────────┤
│  🔧 file-system.js (工具模块)        │
│  ├── 📁  FileSelector (文件选择器)    │
│  ├── 🗂️  FileSystemUtils (文件工具)  │
│  ├── 🎯  DragDropEnhancer (拖拽增强) │
│  └── ⚡  BatchUploadQueue (队列管理) │
└─────────────────────────────────────┘
                   ↕️ IPC 通信
┌─────────────────────────────────────┐
│          Electron 主进程             │
├─────────────────────────────────────┤
│  🖥️  main.js (主进程控制)            │
│  ├── 📂  select-files               │
│  ├── 📁  select-folder               │
│  ├── 🔍  read-directory-recursive    │
│  ├── 📊  get-file-stats             │
│  ├── 🗂️  show-item-in-folder        │
│  └── 🚀  open-path                  │
├─────────────────────────────────────┤
│  🌉  preload.js (安全桥梁)           │
│  ├── 🔒  contextBridge API 暴露      │
│  ├── 🛠️  路径工具函数                │
│  └── 📡  IPC 通信封装               │
└─────────────────────────────────────┘
                   ↕️ 系统调用
┌─────────────────────────────────────┐
│           操作系统 API              │
├─────────────────────────────────────┤
│  📁  文件对话框 (dialog)             │
│  🗂️  文件系统操作 (fs)               │
│  🔍  Shell 集成 (shell)             │
│  📊  文件属性读取 (stats)            │
└─────────────────────────────────────┘
```

### 🔑 **核心 API**

#### **文件选择 API**
```javascript
// 选择多个文件
const result = await window.electronAPI.selectFiles({
  filters: [
    { name: '图片', extensions: ['jpg', 'png', 'gif'] },
    { name: '文档', extensions: ['pdf', 'doc', 'txt'] }
  ]
})

// 选择文件夹
const result = await window.electronAPI.selectFolder()

// 递归读取文件夹
const result = await window.electronAPI.readDirectoryRecursive(folderPath, {
  maxDepth: 10,
  includeHidden: false
})
```

#### **文件系统操作 API**
```javascript
// 获取文件信息
const stats = await window.electronAPI.getFileStats(filePath)

// 在文件管理器中显示
await window.electronAPI.showItemInFolder(filePath)

// 用默认应用打开
await window.electronAPI.openPath(filePath)
```

#### **路径工具 API**
```javascript
// 路径连接
const fullPath = window.electronAPI.path.join('folder', 'file.txt')

// 获取文件名
const fileName = window.electronAPI.path.basename(filePath)

// 获取扩展名
const ext = window.electronAPI.path.extname(filePath)
```

---

## 🔮 下一步开发计划

### 🎯 **即将实现的功能**

1. **📁 文件系统监控**
   - 实时监控文件夹变化
   - 自动同步新增文件
   - 文件修改检测

2. **💾 智能下载管理**
   - 下载路径设置
   - 下载进度管理
   - 系统通知集成

3. **🎵 系统托盘集成**
   - 后台运行支持
   - 快速操作菜单
   - 上传下载状态显示

---

## 🎉 总结

本次文件系统集成为智域云图对象存储平台带来了：

✅ **原生桌面体验** - 完全融入操作系统  
✅ **高效文件操作** - 文件夹批量上传  
✅ **智能队列管理** - 并发上传控制  
✅ **增强拖拽支持** - 文件夹拖拽上传  
✅ **系统级集成** - 文件管理器联动  

这些功能显著提升了桌面用户的使用体验，使应用更像一个真正的桌面软件而非简单的 Web 应用包装。
